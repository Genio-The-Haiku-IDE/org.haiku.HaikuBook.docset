<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=9"/>
	<meta name="generator" content="Doxygen 1.12.0"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<title>The Haiku Book: Introduction to the Launch Daemon</title>
	<link href="tabs.css" rel="stylesheet" type="text/css"/>
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript" src="dynsections.js"></script>
	<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
	<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
	<link href="doxygen.css" rel="stylesheet" type="text/css" />
	<link href="book.css" rel="stylesheet" type="text/css"/>
	</head>
<body>
	<div id="banner">
		<div class="logo">
			<span class="subtitle">
				API Documentation
			</span>
		</div>
	</div>
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Introduction to the Launch Daemon</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In general, you should name your jobs/services after the application signature (if possible), and name the configuration files accordingly (in each case without the "application/" prefix). Alternatively, you may use the name of your package as file name. If you do so, you may want to include the version, too, but do not add the version to the name of a job.</p>
<p>A "service" is re-started automatically by the launch_daemon as soon as it's quit (or has crashed). Use a "job" instead, if you don't want this behavior.</p>
<p>Let's start with a simple example: <code> service x-vnd.MyGreatServer { } </code> This will register a service named MyGreatServer, and assumes it uses a BServer based application object. It will automatically launch the server either during system boot (when you place your configuration file in <code>/system/data/launch/</code>), or after user login (when it's in <code>~/config/data/launch/</code>) via its signature (which it constructs using the job's name). Furthermore, it will create a port for the server, so that it can be immediately be talked to.</p>
<p>Unfortunately, BServer is private as of now, and you didn't want to make a great effort to subclass it. In this case, you have to notify the launch_daemon of this fact by adding a "legacy" to that configuration: </p><div class="fragment"><div class="line">service x-vnd.MyGreatServer {</div>
<div class="line">    legacy</div>
<div class="line">}</div>
</div><!-- fragment --><p> If you want to save the cycles for querying for your server, you can also directly specify the file that should be launched; in this case, the job name is just a name. This could look like this: </p><div class="fragment"><div class="line">service x-vnd.MyGreatServer {</div>
<div class="line">    launch /path/to/my/great/server</div>
<div class="line">    legacy</div>
<div class="line">}</div>
</div><!-- fragment --><p> This method also allows you to add additional launch arguments like this: </p><div class="fragment"><div class="line">service x-vnd.MyGreatServer {</div>
<div class="line">    launch /path/to/my/great/server --debug-mode</div>
<div class="line">    legacy</div>
<div class="line">}</div>
</div><!-- fragment --><p> If you do not want to enable the service by default, but only provide a template or basic configuration for the user, you can disable it like this: </p><div class="fragment"><div class="line">service x-vnd.MyGreatServer {</div>
<div class="line">    launch /path/to/my/great/server --debug-mode</div>
<div class="line">    legacy</div>
<div class="line">    disabled</div>
<div class="line">}</div>
</div><!-- fragment --><p> You can then override this in the settings by redefining the service, and overwrite the parts you want to change. In this case, it might just be: </p><div class="fragment"><div class="line">service x-vnd.MyGreatServer {</div>
<div class="line">    disabled <span class="keyword">false</span></div>
<div class="line">}</div>
</div><!-- fragment --><p> The rest of the configuration will stay intact.</p>
<p>If you only want to launch your application depending on the current environment, you can define conditions which must be met to launch your application at all, and events which will trigger launching your application.</p>
<p>In the configuration file, this could look like this: </p><div class="fragment"><div class="line">service x-vnd.MyGreatServer {</div>
<div class="line">    launch /path/to/my/great/server</div>
<div class="line">    <span class="keywordflow">if</span> {</div>
<div class="line">        not safemode</div>
<div class="line">        file_exists /path/to/license/file</div>
<div class="line">    }</div>
<div class="line">    on {</div>
<div class="line">        demand</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p> Alternatively, there are shortcuts for two of the above items, and you could also write it like this: </p><div class="fragment"><div class="line">service x-vnd.MyGreatServer {</div>
<div class="line">    launch /path/to/my/great/server</div>
<div class="line">    <span class="keywordflow">if</span> {</div>
<div class="line">        file_exists /path/to/license/file</div>
<div class="line">    }</div>
<div class="line">    no_safemode</div>
<div class="line">    on_demand</div>
<div class="line">}</div>
</div><!-- fragment --><p> If you have only single line conditions/events, you may also omit the curly braces completely: </p><div class="fragment"><div class="line">service x-vnd.MyGreatServer {</div>
<div class="line">    launch /path/to/my/great/server</div>
<div class="line">    <span class="keywordflow">if</span> file_exists /path/to/license/file</div>
<div class="line">    no_safemode</div>
<div class="line">    on demand</div>
<div class="line">}</div>
</div><!-- fragment --><p> Note, the "on demand" does not use the "on_demand" shortcut, but just saves the curly braces of "on { demand }".</p>
<p>You can also use operators like "and", "or", and "not" in conditions. If you put more than one condition into an "if" they must all be true in order to meet the condition. Conditions will be evaluated every time the launch_daemon has a reason to start your application &ndash; the outcome of the condition may change over time.</p>
<p>Likewise, if you put more than one event into an "on" only one of them needs to be triggered in order to launch your job. While the event processing is already prepared to allow for an "and" operator, this is not yet available.</p>
<p>You can also specify the environment variables for your application. They can be either specified directly, or you can let a shell script define them for you: </p><div class="fragment"><div class="line">service  x-vnd.MyGreatServer {</div>
<div class="line">    env {</div>
<div class="line">        from_script /path/to/my/script.sh</div>
<div class="line">        LC_CTYPE C.UTF-8</div>
<div class="line">    }</div>
<div class="line">    launch /path/to/my/great/server</div>
<div class="line">}</div>
</div><!-- fragment --><p> If you want to move the job into a specific target, you can write it like this: </p><div class="fragment"><div class="line">target my-target {</div>
<div class="line">    service  x-vnd.MyGreatServer {</div>
<div class="line">        launch /path/to/my/great/server</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p> You will be able to move jobs into targets around in the configuration files, but this has not been implemented at the time of this writing.</p>
<p>Like jobs, and services, targets can use conditions, events, and environment variables. If you do not specify an event for your target, it will not launch automatically unless it's requested by name. Furthermore, jobs within your target will not be available unless the target has been launched either manually or by event.</p>
<p>You can also let the launch_daemon create resources for your application, like additional named ports. These ports will be available to other applications without having to launch your application, and will belong to the launch_daemon throughout their lifetime.</p>
<p>Finally, there is a "run" directive that you can use to launch targets unconditionally. The "run" directive also allows to use conditions, but adds the additional keywords "then", and "else" like this: </p><div class="fragment"><div class="line">run {</div>
<div class="line">    <span class="keywordflow">if</span> read_only</div>
<div class="line">    then installer</div>
<div class="line">    <span class="keywordflow">else</span> desktop</div>
<div class="line">}</div>
</div><!-- fragment --><p> You can also use curly braces if you like or want to run more than one job.</p>
<p>It's a good idea to look at the existing configuration files to get an idea how this is all supposed to work. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
  <hr class="footer"/><address class="footer"><small>
    The Haiku Book pre-R1 - Introduction to the Launch Daemon<br />
    Generated on Sat May 24 2025 23:12:17 by <a href="http://www.doxygen.org/index.html">Doxygen</a> 1.12.0
  </small></address>
</body>
</html>
