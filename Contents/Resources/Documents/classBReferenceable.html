<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=9"/>
	<meta name="generator" content="Doxygen 1.12.0"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<title>The Haiku Book: BReferenceable Class Reference</title>
	<link href="tabs.css" rel="stylesheet" type="text/css"/>
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript" src="dynsections.js"></script>
	<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
	<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
	<link href="doxygen.css" rel="stylesheet" type="text/css" />
	<link href="book.css" rel="stylesheet" type="text/css"/>
	</head>
<body>
	<div id="banner">
		<div class="logo">
			<span class="subtitle">
				API Documentation
			</span>
		</div>
	</div>
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="classBReferenceable-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">BReferenceable Class Reference<div class="ingroups"><a class="el" href="group__support.html">Support Kit</a> &#124; <a class="el" href="group__libbe.html">(libbe.so)</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Implementation of reference-counted memory management.  
 <a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:aef45178f24465974be5d385b204176e3" id="r_aef45178f24465974be5d385b204176e3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aef45178f24465974be5d385b204176e3">BReferenceable</a> ()</td></tr>
<tr class="memdesc:aef45178f24465974be5d385b204176e3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the object with a reference count of 1.  <br /></td></tr>
<tr class="separator:aef45178f24465974be5d385b204176e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab530d96dbd2462556e78323144f0e585" id="r_ab530d96dbd2462556e78323144f0e585"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab530d96dbd2462556e78323144f0e585">~BReferenceable</a> ()</td></tr>
<tr class="memdesc:ab530d96dbd2462556e78323144f0e585"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor.  <br /></td></tr>
<tr class="separator:ab530d96dbd2462556e78323144f0e585"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac98c8b1801978166c2a7e6c994fb689a" id="r_ac98c8b1801978166c2a7e6c994fb689a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="SupportDefs_8h.html#a87905854573530ba20766196388ad2a1">int32</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac98c8b1801978166c2a7e6c994fb689a">AcquireReference</a> ()</td></tr>
<tr class="memdesc:ac98c8b1801978166c2a7e6c994fb689a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Acquire a reference to the object.  <br /></td></tr>
<tr class="separator:ac98c8b1801978166c2a7e6c994fb689a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ffe8211f9390cb6b83f0fc86824a3a1" id="r_a2ffe8211f9390cb6b83f0fc86824a3a1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="SupportDefs_8h.html#a87905854573530ba20766196388ad2a1">int32</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2ffe8211f9390cb6b83f0fc86824a3a1">CountReferences</a> () const</td></tr>
<tr class="memdesc:a2ffe8211f9390cb6b83f0fc86824a3a1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the number of references to the object.  <br /></td></tr>
<tr class="separator:a2ffe8211f9390cb6b83f0fc86824a3a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a699a804cd2650e9f9078c49958aa431b" id="r_a699a804cd2650e9f9078c49958aa431b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="SupportDefs_8h.html#a87905854573530ba20766196388ad2a1">int32</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a699a804cd2650e9f9078c49958aa431b">ReleaseReference</a> ()</td></tr>
<tr class="memdesc:a699a804cd2650e9f9078c49958aa431b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Release a reference to the object.  <br /></td></tr>
<tr class="separator:a699a804cd2650e9f9078c49958aa431b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-methods" name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a70d663aacc449223d2f4e426bfbc6653" id="r_a70d663aacc449223d2f4e426bfbc6653"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a70d663aacc449223d2f4e426bfbc6653">FirstReferenceAcquired</a> ()</td></tr>
<tr class="memdesc:a70d663aacc449223d2f4e426bfbc6653"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called when the first reference to the object is reacquired.  <br /></td></tr>
<tr class="separator:a70d663aacc449223d2f4e426bfbc6653"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98365f2d21c5a4fe8bee5633c176add9" id="r_a98365f2d21c5a4fe8bee5633c176add9"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a98365f2d21c5a4fe8bee5633c176add9">LastReferenceReleased</a> ()</td></tr>
<tr class="memdesc:a98365f2d21c5a4fe8bee5633c176add9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called when the last reference to the object is released.  <br /></td></tr>
<tr class="separator:a98365f2d21c5a4fe8bee5633c176add9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implementation of reference-counted memory management. </p>
<p>The C++ language provides two main ways of allocating objects: on the stack, and on the heap. Objects created on the heap must be managed by the application and deleted when they are not needed. Objects allocated on the stack have a lifetime limited to the execution of the block they are declared in.</p>
<p>This approach is simple, but in some cases it can become quite difficult to track ownership and lifetime of objects. The <a class="el" href="classBReferenceable.html" title="Implementation of reference-counted memory management.">BReferenceable</a> class allows to implement reference counting, which allows a partially automated memory management and some safety checks. It can also be used to implement pools of reusable objects.</p>
<p>As the name implies, reference counting consists of keeping track, inside an object, of how much references there are to it in the running application. When the object is not referenced anymore, it can't be reached or used from other parts of the application, so it is safe to delete or recycle the object.</p>
<p>To use reference counting for a particular class, you make it inherit <a class="el" href="classBReferenceable.html" title="Implementation of reference-counted memory management.">BReferenceable</a>. This provides all the support for reference counting. Objects are created as usual, on the stack or using the new operator.</p>
<p>The object can then be referenced from other places. Each time a reference to it is kept, the owner of the reference should call AcquireReference. When the reference is not needed, it should call ReleaseReference.</p>
<dl class="section since"><dt>Since</dt><dd>Haiku R1 </dd></dl>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="aef45178f24465974be5d385b204176e3" name="aef45178f24465974be5d385b204176e3"></a>
<h2 class="memtitle"><span class="permalink"><a name="//apple_ref/cpp/Method/BReferenceable" class="dashAnchor">&nbsp;</a><a href="#aef45178f24465974be5d385b204176e3">&#9670;&#160;</a></span>BReferenceable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BReferenceable::BReferenceable </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the object with a reference count of 1. </p>
<p>The creator of the object is assumed to owns the first reference to it. </p>

</div>
</div>
<a id="ab530d96dbd2462556e78323144f0e585" name="ab530d96dbd2462556e78323144f0e585"></a>
<h2 class="memtitle"><span class="permalink"><a name="//apple_ref/cpp/Method/~BReferenceable" class="dashAnchor">&nbsp;</a><a href="#ab530d96dbd2462556e78323144f0e585">&#9670;&#160;</a></span>~BReferenceable()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual BReferenceable::~BReferenceable </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Destructor. </p>
<p>The destructor should not be called directly, as the object is destructed automatically when the last reference is released. This destructor is public because you may still need to destroy the objects in the case where LastReferenceReleased is overriden and you handle object destruction in some other way.</p>
<p>In debug mode, the destructor checks that no references to the object are still held. If the object was allocated on the stack, it allows exactly one reference to be kept, which makes it possible to allocate <a class="el" href="classBReferenceable.html" title="Implementation of reference-counted memory management.">BReferenceable</a> on the stack without needing to release the single reference to it. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="ac98c8b1801978166c2a7e6c994fb689a" name="ac98c8b1801978166c2a7e6c994fb689a"></a>
<h2 class="memtitle"><span class="permalink"><a name="//apple_ref/cpp/Method/AcquireReference" class="dashAnchor">&nbsp;</a><a href="#ac98c8b1801978166c2a7e6c994fb689a">&#9670;&#160;</a></span>AcquireReference()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="SupportDefs_8h.html#a87905854573530ba20766196388ad2a1">int32</a> BReferenceable::AcquireReference </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Acquire a reference to the object. </p>
<dl class="section return"><dt>Returns</dt><dd>the previous reference count</dd></dl>
<p>If the reference count was previously 0, this will call FirstReferenceAcquired. </p>

</div>
</div>
<a id="a2ffe8211f9390cb6b83f0fc86824a3a1" name="a2ffe8211f9390cb6b83f0fc86824a3a1"></a>
<h2 class="memtitle"><span class="permalink"><a name="//apple_ref/cpp/Method/CountReferences" class="dashAnchor">&nbsp;</a><a href="#a2ffe8211f9390cb6b83f0fc86824a3a1">&#9670;&#160;</a></span>CountReferences()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="SupportDefs_8h.html#a87905854573530ba20766196388ad2a1">int32</a> BReferenceable::CountReferences </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return the number of references to the object. </p>
<dl class="section return"><dt>Returns</dt><dd>the reference count. </dd></dl>

<p class="reference">References <a class="el" href="group__support__globals.html#ga61648da3ddc2f3df3c0b08b14b5dd09e">atomic_get()</a>.</p>

</div>
</div>
<a id="a70d663aacc449223d2f4e426bfbc6653" name="a70d663aacc449223d2f4e426bfbc6653"></a>
<h2 class="memtitle"><span class="permalink"><a name="//apple_ref/cpp/Method/FirstReferenceAcquired" class="dashAnchor">&nbsp;</a><a href="#a70d663aacc449223d2f4e426bfbc6653">&#9670;&#160;</a></span>FirstReferenceAcquired()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void BReferenceable::FirstReferenceAcquired </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Called when the first reference to the object is reacquired. </p>
<p>The default implementation does nothing. This method can be overriden to implement reinitialization of the object, when using <a class="el" href="classBReferenceable.html" title="Implementation of reference-counted memory management.">BReferenceable</a> to keep track of a pool of reusable objects.</p>
<p>In this use case, the objects are created (at initialization or lazily on an as-needed basis) and stored in a pool. When an object is needed, if there is an unused one waiting in the pool, it is reused instead of creating a new one. Once a reference to it is acquired, this method is called and the object can initialize itself to a clean state.</p>
<dl class="section warning"><dt>Warning</dt><dd>This is currently not called when the object is first created, but only on subsequent reuses. </dd></dl>

</div>
</div>
<a id="a98365f2d21c5a4fe8bee5633c176add9" name="a98365f2d21c5a4fe8bee5633c176add9"></a>
<h2 class="memtitle"><span class="permalink"><a name="//apple_ref/cpp/Method/LastReferenceReleased" class="dashAnchor">&nbsp;</a><a href="#a98365f2d21c5a4fe8bee5633c176add9">&#9670;&#160;</a></span>LastReferenceReleased()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void BReferenceable::LastReferenceReleased </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Called when the last reference to the object is released. </p>
<p>This function is called when the object is not referenced anymore. The default implementation deletes the object using the delete operator.</p>
<p>This behavior can be overriden. For example, to implement an object pool, this method would not delete the object, but instead put it back in the free object pool, ready for reuse at a later point. </p>

</div>
</div>
<a id="a699a804cd2650e9f9078c49958aa431b" name="a699a804cd2650e9f9078c49958aa431b"></a>
<h2 class="memtitle"><span class="permalink"><a name="//apple_ref/cpp/Method/ReleaseReference" class="dashAnchor">&nbsp;</a><a href="#a699a804cd2650e9f9078c49958aa431b">&#9670;&#160;</a></span>ReleaseReference()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="SupportDefs_8h.html#a87905854573530ba20766196388ad2a1">int32</a> BReferenceable::ReleaseReference </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Release a reference to the object. </p>
<dl class="section return"><dt>Returns</dt><dd>the previous reference count</dd></dl>
<p>If the reference count was previously 1 (and is now 0), this will call LastReferenceReleased. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
  <hr class="footer"/><address class="footer"><small>
    The Haiku Book pre-R1 - BReferenceable Class Reference<br />
    Generated on Sat May 24 2025 23:12:19 by <a href="http://www.doxygen.org/index.html">Doxygen</a> 1.12.0
  </small></address>
</body>
</html>
