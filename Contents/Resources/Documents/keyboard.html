<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=9"/>
	<meta name="generator" content="Doxygen 1.12.0"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<title>The Haiku Book: Keyboard</title>
	<link href="tabs.css" rel="stylesheet" type="text/css"/>
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript" src="dynsections.js"></script>
	<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
	<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
	<link href="doxygen.css" rel="stylesheet" type="text/css" />
	<link href="book.css" rel="stylesheet" type="text/css"/>
	</head>
<body>
	<div id="banner">
		<div class="logo">
			<span class="subtitle">
				API Documentation
			</span>
		</div>
	</div>
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Keyboard</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page details how Haiku reads keys from the keyboard including modifier key and special characters, and how you can read and process these encoded characters in your application.</p>
<h1><a class="anchor" id="unicode"></a>
Haiku and UTF-8</h1>
<p>Haiku encodes all characters using UTF-8. UTF-8 allows Haiku to represent characters from all over the world while still maintaining backwards compatibility with 7-bit ASCII codes. This means that the most commonly used characters are encoded in just one byte while less common characters can be encoded by extending the character encoding to use two, three, or, rarely, four bytes.</p>
<h1><a class="anchor" id="keycodes"></a>
Key Codes</h1>
<p>Each key on the keyboard is assigned a numeric code to identify it to the operating system. Most of the time you should not have to access these codes directly, instead use one of the constants defined in <a class="el" href="InterfaceDefs_8h.html" title="Defines standard interface definitions for controls.">InterfaceDefs.h</a> such <code>B_BACKSPACE</code> or <code>B_ENTER</code> or read the character from the <code>key_map</code> struct.</p>
<p>The following diagram shows the key codes as they appear on a US 104-key keyboard.</p>
<div class="image">
<img src="US_PC_keyboard_keycodes.png" alt=""/>
</div>
<p>In addition to the keys listed in the picture above, some more keys are defined:</p>
<p>International keyboards each differ a bit but generally share an extra key located in-between the left shift key and Z with the key code 0x69.</p>
<p>Japanese keyboards also have a second extra key, either at the left of or under backspace. This second extra key gets the code 0x6b.</p>
<p>Mac keyboards have an equal sign in the keypad with key code 0x6a. Some other keys produce the same key code but appear in different locations than their PC counterparts.</p>
<p>BeOS used to allocate 0x6b to the power button on ADB keyboards. This is not the case in Haiku, instead, see the "multimedia" keys information below for the power button handling.</p>
<p>Some keyboards provide additional "multimedia" keys. These are reported based on their USB HID keycodes. Note that these codes are larger than 127, and therefore cannot be mapped in the keymap. These keys can only be handled using B_UNMAPPED_KEY_DOWN messages and are never associated with a character.</p>
<p>Here is a list of the commonly available key codes not visible in the keyboard picture above:</p>
<table class="doxtable">
<tr>
<th>Key code</th><th>Description </th></tr>
<tr>
<td>0x69</td><td>First extra international key </td></tr>
<tr>
<td>0x6a</td><td>Numpad = </td></tr>
<tr>
<td>0x6b</td><td>Second extra international key </td></tr>
<tr>
<td>0x6c</td><td>Muhenkan (left of space bar on Japanese keyboards) </td></tr>
<tr>
<td>0x6d</td><td>Henkan (first key right of spacebar on Japanese keyboards) </td></tr>
<tr>
<td>0x6e</td><td>Katakana/Hiragana (second key right of spacebar on Japanese keyboards) </td></tr>
<tr>
<td>0xf0</td><td>Hangul key (for Korean keyboards) </td></tr>
<tr>
<td>0xf1</td><td>Hangul hanja key (for Korean keyboards) </td></tr>
<tr>
<td>0x00010081</td><td>Power off </td></tr>
<tr>
<td>0x00010082</td><td>Sleep </td></tr>
<tr>
<td>0x00010083</td><td>Wake up </td></tr>
<tr>
<td>0x000C00B0</td><td>Play media </td></tr>
<tr>
<td>0x000C00B5</td><td>Scan next track </td></tr>
<tr>
<td>0x000C00B6</td><td>Scan previous track </td></tr>
<tr>
<td>0x000C00B7</td><td>Stop media </td></tr>
<tr>
<td>0x000C00E2</td><td>Mute sound </td></tr>
<tr>
<td>0x000C00E9</td><td>Increase sound volume </td></tr>
<tr>
<td>0x000C00EA</td><td>Decrease sound volume </td></tr>
<tr>
<td>0x000C0183</td><td>Launch control configuration application </td></tr>
<tr>
<td>0x000C018A</td><td>Launch e-mail application </td></tr>
<tr>
<td>0x000C0192</td><td>Launch calculator application </td></tr>
<tr>
<td>0x000C0194</td><td>Launch file manager application </td></tr>
<tr>
<td>0x000C0221</td><td>Search </td></tr>
<tr>
<td>0x000C0223</td><td>Go to home page </td></tr>
<tr>
<td>0x000C0224</td><td>Previous page </td></tr>
<tr>
<td>0x000C0225</td><td>Next page </td></tr>
<tr>
<td>0x000C0226</td><td>Stop </td></tr>
<tr>
<td>0x000C0227</td><td>Refresh </td></tr>
<tr>
<td>0x000C022A</td><td>Bookmarks </td></tr>
</table>
<h1><a class="anchor" id="modifiers"></a>
Modifier Keys</h1>
<p>Modifier keys are keys which have no effect on their own but when combined with another key modify the usual behavior of that key.</p>
<p>The following modifier keys are defined in <a class="el" href="InterfaceDefs_8h.html" title="Defines standard interface definitions for controls.">InterfaceDefs.h</a></p>
<table class="doxtable">
<tr>
<td><code>B_SHIFT_KEY</code>  </td><td>Transforms lowercase case characters into uppercase characters or chooses alternative punctuation characters. The shift key is also used in combination with <code>B_COMMAND_KEY</code> to produce keyboard shortcuts.   </td></tr>
<tr>
<td><code>B_COMMAND_KEY</code>  </td><td>Produces keyboard shortcuts for common operations such as cut, copy, paste, print, and find.   </td></tr>
<tr>
<td><code>B_CONTROL_KEY</code>  </td><td>Outputs control characters in terminal. The control key is sometimes also used as an alternative to <code>B_COMMAND_KEY</code> to produce keyboard shortcuts in applications.   </td></tr>
<tr>
<td><code>B_OPTION_KEY</code>  </td><td>Used to in combination with other keys to output special characters such as accented letters and symbols. Because <code>B_OPTION_KEY</code> is not found on all keyboards it should not be used for essential functions.   </td></tr>
<tr>
<td><code>B_MENU_KEY</code>  </td><td>The Menu key is used to produce contextual menus. Like <code>B_OPTION_KEY</code>, the Menu key should not be used for essential functions since it is not available on all keyboards.   </td></tr>
</table>
<p>In addition you can access the left and right modifier keys individually with the following constants: </p><table class="doxtable">
<tr>
<td><code>B_LEFT_SHIFT_KEY</code>  </td><td><code>B_RIGHT_SHIFT_KEY</code>  </td><td><code>B_LEFT_COMMAND_KEY</code>  </td><td><code>B_RIGHT_COMMAND_KEY</code>   </td></tr>
<tr>
<td><code>B_LEFT_CONTROL_KEY</code>  </td><td><code>B_RIGHT_CONTROL_KEY</code>  </td><td><code>B_LEFT_OPTION_KEY</code>  </td><td><code>B_RIGHT_OPTION_KEY</code>   </td></tr>
</table>
<p>Scroll lock, num lock, and caps lock alter other keys pressed after they are released. They are defined by the following constants:</p>
<table class="doxtable">
<tr>
<td><code>B_CAPS_LOCK</code>  </td><td>Produces uppercase characters. Reverses the effect of <code>B_SHIFT_KEY</code> for letters.   </td></tr>
<tr>
<td><code>B_SCROLL_LOCK</code>  </td><td>Prevents the terminal from scrolling.   </td></tr>
<tr>
<td><code>B_NUM_LOCK</code>  </td><td>Informs the numeric keypad to output numbers when on. Reverses the function of <code>B_SHIFT_KEY</code> for keys on the numeric keypad.   </td></tr>
</table>
<p>To get the currently active modifiers use the <a class="el" href="InterfaceDefs_8h.html#a1378b08d543f75ebc35df699573c526e" title="Gets a bitmap of each modifier key pressed down and each active keyboard lock.">modifiers()</a> function defined in <a class="el" href="InterfaceDefs_8h.html" title="Defines standard interface definitions for controls.">InterfaceDefs.h</a>. This function returns a bitmap containing the currently active modifier keys. You can create a bit mask of the above constants to determine which modifiers are active.</p>
<h1><a class="anchor" id="other_constants"></a>
Other Constants</h1>
<p>The Interface Kit also defines constants for keys that are aren't represented by a symbol, these include:</p>
<table class="doxtable">
<tr>
<td><code>B_BACKSPACE</code>  </td><td><code>B_RETURN</code>  </td><td><code>B_ENTER</code>  </td><td><code>B_SPACE</code>  </td><td><code>B_TAB</code>  </td><td><code>B_ESCAPE</code>   </td></tr>
<tr>
<td><code>B_SUBSTITUTE</code>  </td><td><code>B_LEFT_ARROW</code>  </td><td><code>B_RIGHT_ARROW</code>  </td><td><code>B_UP_ARROW</code>  </td><td><code>B_DOWN_ARROW</code>  </td><td><code>B_INSERT</code>   </td></tr>
<tr>
<td><code>B_DELETE</code>  </td><td><code>B_HOME</code>  </td><td><code>B_END</code>  </td><td><code>B_PAGE_UP</code>  </td><td><code>B_PAGE_DOWN</code>  </td><td><code>B_FUNCTION_KEY</code>   </td></tr>
</table>
<p>The <code>B_FUNCTION_KEY</code> constant can further be broken down into the following constants: </p><table class="doxtable">
<tr>
<td><code>B_F1_KEY</code>  </td><td><code>B_F4_KEY</code>  </td><td><code>B_F7_KEY</code>  </td><td><code>B_F10_KEY</code>  </td><td><code>B_PRINT_KEY</code> (Print Screen)  </td></tr>
<tr>
<td><code>B_F2_KEY</code>  </td><td><code>B_F5_KEY</code>  </td><td><code>B_F8_KEY</code>  </td><td><code>B_F11_KEY</code>  </td><td><code>B_SCROLL_KEY</code> (Scroll Lock)  </td></tr>
<tr>
<td><code>B_F3_KEY</code>  </td><td><code>B_F6_KEY</code>  </td><td><code>B_F9_KEY</code>  </td><td><code>B_F12_KEY</code>  </td><td><code>B_PAUSE_KEY</code> (Pause/Break)  </td></tr>
</table>
<p>For Japanese keyboard two more constants are defined:</p><ul>
<li><code>B_KATAKANA_HIRAGANA</code> </li>
<li><code>B_HANKAKU_ZENKAKU</code> </li>
</ul>
<h1><a class="anchor" id="keymap"></a>
The Keymap</h1>
<p>The characters produced by each of the key codes is determined by the keymap. The usual way for the user to choose and modify their keymap is the Keymap preference application. A number of alternative keymaps such as dvorak and keymaps for different locales are available.</p>
<div class="image">
<img src="keymap.png" alt=""/>
</div>
<p>A full description of the Keymap preflet can be found in the <a href="http://haiku-os.org/docs/userguide/en/preferences/keymap.html">User Guide</a>.</p>
<p>The keymap is a map of the characters produced by each key on the keyboard including the characters produced when combined with the modifier constants described above. The keymap also contains the codes of the modifier keys and tables for dead keys.</p>
<p>To get the current system keymap create a pointer to a <code>key_map</code> struct and <code>char</code> array and pass their addresses to the <a class="el" href="InterfaceDefs_8h.html#ab4902c396dd4d5ebb19f27bd4b63f614" title="Provides a copy of the system keymap.">get_key_map()</a> function. The <code>key_map</code> struct will be filled out with the current system keymap and the <code>char</code> array will be filled out with the UTF-8 character encodings.</p>
<p>The <code>key_map</code> struct contains a number of fields. Each field is described in several sections below.</p>
<p>The first section contains a version number and the code assigned to each of the modifier keys.</p>
<table class="doxtable">
<tr>
<td><code>version</code>  </td><td>The version number of the keymap  </td></tr>
<tr>
<td><code>caps_key</code> <br  />
 <code>scroll_key</code> <br  />
 <code>num_key</code>  </td><td>Lock key codes  </td></tr>
<tr>
<td><code>left_shift_key</code> <br  />
 <code>right_shift_key</code>  </td><td>Left and right shift key codes  </td></tr>
<tr>
<td><code>left_command_key</code> <br  />
 <code>right_command_key</code>  </td><td>Left and right command key codes  </td></tr>
<tr>
<td><code>left_control_key</code> <br  />
 <code>right_control_key</code>  </td><td>Left and right control key codes  </td></tr>
<tr>
<td><code>left_option_key</code> <br  />
 <code>right_option_key</code>  </td><td>Left and right option key codes  </td></tr>
<tr>
<td><code>menu_key</code>  </td><td>Menu key code  </td></tr>
<tr>
<td><code>lock_settings</code>  </td><td>A bitmap containing the default state of the lock keys  </td></tr>
</table>
<p>To programmatically set a modifier key in the system keymap use the <a class="el" href="InterfaceDefs_8h.html#ac4ec63e4e6c08a95cc0ffc7a20ca0e6f" title="Set the modifier key to the specified code in the system keymap.">set_modifier_key()</a> function. You can also programmatically set the state of the num lock, caps lock, and scroll lock keys by calling the <a class="el" href="InterfaceDefs_8h.html#aaedfd092d2abb375bc0b49661458b797" title="Set the keyboard locks.">set_keyboard_locks()</a> function.</p>
<h1><a class="anchor" id="character_maps"></a>
Character Maps</h1>
<p>The next section of the <code>key_map</code> struct contains maps of offsets into the array of UTF-8 character encodings filled out in the second parameter of <a class="el" href="InterfaceDefs_8h.html#ab4902c396dd4d5ebb19f27bd4b63f614" title="Provides a copy of the system keymap.">get_key_map()</a>. Since the character maps are filled with UTF-8 characters they may be 1, 2, 3, or rarely 4 bytes long. The characters are contained in non-<code>NUL</code> terminated Pascal strings. The first byte of the string indicates how many bytes the character is made up of. For example the string for a horizontal ellipses (...) character looks like this:</p>
<div class="fragment"><div class="line">x03xE2x80xA6</div>
</div><!-- fragment --><p>The first byte is 03 meaning that the character is 3 bytes long. The remaining bytes E2 80 A6 are the UTF-8 byte representation of the horizontal ellipses character. Recall that there is no terminating <code>NUL</code> character for these strings.</p>
<p>Not every key is mapped to a character. If a key is unmapped the character array contains a 0-byte string. Unmapped keys do not produce <code>B_KEY_DOWN</code> messages.</p>
<p>Modifier keys should not be mapped into the character array.</p>
<p>The following character maps are defined: </p><table class="doxtable">
<tr>
<td><code>control_map</code>  </td><td>Map of characters when the control key is pressed  </td></tr>
<tr>
<td><code>option_caps_shift_map</code>  </td><td>Map of characters when caps lock is turned on and both the option key and shift keys are pressed.   </td></tr>
<tr>
<td><code>option_caps_map</code>  </td><td>Map of characters when caps lock is turned on and the option key is pressed   </td></tr>
<tr>
<td><code>option_shift_map</code>  </td><td>Map of characters when both shift and option keys are pressed  </td></tr>
<tr>
<td><code>option_map</code>  </td><td>Map of characters when the option key is pressed  </td></tr>
<tr>
<td><code>caps_shift_map</code>  </td><td>Map of characters when caps lock is on and the shift key is pressed   </td></tr>
<tr>
<td><code>caps_map</code>  </td><td>Map of characters when caps lock is turned on  </td></tr>
<tr>
<td><code>shift_map</code>  </td><td>Map of characters when shift is pressed  </td></tr>
<tr>
<td><code>normal_map</code>  </td><td>Map of characters when no modifiers keys are pressed  </td></tr>
</table>
<h1><a class="anchor" id="dead_keys"></a>
Dead Keys</h1>
<p>Dead keys are keys that do not produce a character until they are combined with another key. Because these keys do not produce a character on their own they are considered "dead" until they are "brought to life" by being combined with another key. Dead keys are generally used to produce accented characters.</p>
<p>Each of the fields below is a 32-byte array of dead key characters. The dead keys are organized into pairs in the array. Each dead key array can contain up to 16 pairs of dead key characters. The first pair in the array should contain <code>B_SPACE</code> followed by and the accent character in the second offset. This serves to identify which accent character is contained in the array and serves to define a space followed by accent pair to represent the unadorned accent character.</p>
<p>The rest of the array is filled with pairs containing an unaccented character followed by the accent character.</p>
<table class="doxtable">
<tr>
<td><code>acute_dead_key</code>  </td><td>Acute dead keys array  </td></tr>
<tr>
<td><code>grave_dead_key</code>  </td><td>Grave dead keys array  </td></tr>
<tr>
<td><code>circumflex_dead_key</code>  </td><td>Circumflex dead keys array  </td></tr>
<tr>
<td><code>dieresis_dead_key</code>  </td><td>Dieresis dead keys array  </td></tr>
<tr>
<td><code>tilde_dead_key</code>  </td><td>Tilde dead keys array  </td></tr>
</table>
<p>The final section contains bitmaps that indicate which character table is used for each of the above dead keys. The bitmap can contain any of the following constants:</p><ul>
<li><code>B_CONTROL_TABLE</code> </li>
<li><code>B_CAPS_SHIFT_TABLE</code> </li>
<li><code>B_OPTION_CAPS_SHIFT_TABLE</code> </li>
<li><code>B_CAPS_TABLE</code> </li>
<li><code>B_OPTION_CAPS_TABLE</code> </li>
<li><code>B_SHIFT_TABLE</code> </li>
<li><code>B_OPTION_SHIFT_TABLE</code> </li>
<li><code>B_NORMAL_TABLE</code> </li>
<li><code>B_OPTION_TABLE</code> </li>
</ul>
<p>The bitmaps often contain <code>B_OPTION_TABLE</code> because accent characters are generally produced by combining a letter with <code>B_OPTION_KEY</code>.</p>
<table class="doxtable">
<tr>
<td><code>acute_tables</code>  </td><td>Acute dead keys table bitmap  </td></tr>
<tr>
<td><code>grave_tables</code>  </td><td>Grave dead keys table bitmap  </td></tr>
<tr>
<td><code>circumflex_tables</code>  </td><td>Circumflex dead keys table bitmap  </td></tr>
<tr>
<td><code>dieresis_tables</code>  </td><td>Dieresis dead keys table bitmap  </td></tr>
<tr>
<td><code>tilde_tables</code>  </td><td>Tilde dead keys table bitmap  </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
  <hr class="footer"/><address class="footer"><small>
    The Haiku Book pre-R1 - Keyboard<br />
    Generated on Sat May 24 2025 23:12:17 by <a href="http://www.doxygen.org/index.html">Doxygen</a> 1.12.0
  </small></address>
</body>
</html>
